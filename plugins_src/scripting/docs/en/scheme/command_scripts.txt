Command Scripts

Command scripts are available when right clicking on a selected object

The "points" extra parameter is needed to access the list of vertices, which come as a vertice number and a 3 dimensional position.

<code><pre>
(main-function
    (lambda (*params* *extra-params*)
        ;; The mode of the command: 'body 'face 'vertex 'edge
        (define op     (list-ref
                         (assoc "op" *extra-params*) 1))
        ;; The list of selected items (if op is 'face , then sel
        ;; contains a list of face numbers.
        (define sel    (list-ref
                         (assoc "sel" *extra-params*) 1))
        ;; A "points" list is available if the command_inputs
        ;; has "points" in its comma-separated list.
        (define points (list-ref
                         (assoc "points" *extra-params*) 1))

        ;; ...

        ;; Return new positions of vertices
        (list (list 'set_points points))
        ))
</pre></code>


The following script shifts all the vertice positions of a selected object by 0.5 in all axis:

<code><pre>
(main-function
    (lambda (*params* *extra-params*)
        (define op     (list-ref
                         (assoc "op"     *extra-params*) 1))
        (define points (list-ref
                         (assoc "points" *extra-params*) 1))
        (define newpoints
            (map (lambda (p)
                (define a (vector-ref p 0))
                (define b (vector-ref p 1))
                (define x (vector-ref b 0))
                (define y (vector-ref b 1))
                (define z (vector-ref b 2))
                (vector a (vector
                            (+ 0.5 x)
                            (+ 0.5 y)
                            (+ 0.5 z)))
            ) points))
        (list (list 'set_points newpoints ))
        ))
</pre></code>

The op variable contains which mode the command script is in, such as "vertex", "edge", "face" and "body". The modes the script runs in is set with the <b>mode</b> directive in the .wscr file.

An .wscr file to use with the script:

<code><pre>
type "scm"
name ?__(1,"Example Simple Script")
desc ?__(2,"Example Simple Script")
mode "body"
params_title ?__(3,"Example Simple Script")
command_inputs "points"
command_changes "points"
params {
  param "Unused" 0.0
}
</pre></code>

The .wscr and .scm file should have the same name before the extension (script.scm and script.wscr).

To use parameters with the command script, such as shifting the points by an adjustable value:

<code><pre>
(main-function
    (lambda (*params* *extra-params*)
        (define op     (list-ref
                         (assoc "op"     *extra-params*) 1))
        (define points (list-ref
                         (assoc "points" *extra-params*) 1))
        (define val (list-ref *params* 0))
        (define newpoints
            (map (lambda (p)
                (define a (vector-ref p 0))
                (define b (vector-ref p 1))
                (define x (vector-ref b 0))
                (define y (vector-ref b 1))
                (define z (vector-ref b 2))
                (vector a (vector
                            (+ val x)
                            (+ val y)
                            (+ val z)))
            ) points))
        (list (list 'set_points newpoints ))
        ))
</pre></code>

In the .wscr file, rename the "Unused" parameter to "Move":

<code><pre>
type "scm"
name ?__(1,"Example Simple Script")
desc ?__(2,"Example Simple Script")
mode "body"
params_title ?__(3,"Example Simple Script")
command_inputs "points"
command_changes "points"
params {
  param "Move" 0.5
}
</pre></code>



Changes

Depending on the kind of changes you are making, you add to the list:
'set_points
'set_face_uvs
'set_face_colors
'set_e3d_mesh

You also need to add to the command_inputs and command_changes directives the data needed, and what data will be changed. For the script using set_points, the following is needed in the .wscr file:
<code><pre>
command_inputs "points"
command_changes "points"
</pre></code>


Advanced Commands

Simple command scripts can be used to change the point coordinates, the UV values and colors. For more complicated tasks where the mesh needs more complicated changes, there are two options: E3DMesh scripts and We function based scripts.

The E3DMesh script option the .wscr needs to specify the following options:
<code><pre>
command_inputs "e3d_mesh"
command_changes "e3d_mesh"
</pre></code>

With this option, the script gets a E3DMesh object, and the E3DMesh can be changed, and then returned. Then the object's winged edge structure is recreated. This option is most useful when the script is a wrapper for external tools that expect meshes as list of faces and vertex array such as in a .obj file. A caveat of this option is the mesh will have to be turned into a list of faces and vertices, and then rebuilt back to a winged edge structure, so faces, edges and vertices will be renumbered.

An example command that just returns the E3DMesh unchanged:

<code><pre>
(main-function command)
    (lambda (*params* *extra-params*)
        (define op   (list-ref (assoc "op" *extra-params*) 1))
        (define mesh (list-ref (assoc "e3d_mesh" *extra-params*) 1))

        (list (list 'set_e3d_mesh mesh))
        ))
</pre></code>

An example of moving the object by 0.5 in all axis:

<code><pre>
(main-function command)
    (lambda (*params* *extra-params*)
        (define op   (list-ref (assoc "op" *extra-params*) 1))
        (define mesh (list-ref (assoc "e3d_mesh" *extra-params*) 1))

        (define points (e3d_mesh-vs mesh))

        (define newpoints #f)
        (define newmesh #f)

        (set! newpoints
            (map (lambda (b)
                (let ((x (vector-ref b 0))
                      (y (vector-ref b 1))
                      (z (vector-ref b 2)))
                    (vector
                        (+ 0.5 x)
                        (+ 0.5 y)
                        (+ 0.5 z)))
            ) points))

        (set! newmesh
            (**loader-construct-from `((vs ,newpoints)) mesh (list 'type  'vs  'vc  'tx  'ns  'fs 'he  'matrix))
            )
        (list (list 'set_e3d_mesh newmesh))
        ))
</pre></code>

An .wscr file to use with the script:

<code><pre>
type "scm"
name ?__(1,"Example E3D Mesh Script")
desc ?__(2,"Example E3D Mesh Script")
mode "body"
params_title ?__(3,"Example E3D Mesh Script")
command_inputs "e3d_mesh"
command_changes "e3d_mesh"
params {
  param "Unused" 0.0
}
</pre></code>


Advanced We Function Scripts

Scripts can use the we functions from Wings3D directly. When using this option, the command script does not need to use the command_inputs and command_changes directives, and the return from the script can be an empty list. Instead the script contains a sequence of we function calls that modifies the we object.


An example of moving the object by 0.5 in all axis using a we function, in this case, matrix transformation of the vertices:

<code><pre>
(main-function command)
    (lambda (*params* *extra-params*)
        (define op     (list-ref (assoc "op" *extra-params*) 1))
        
        (define MoveX 0.5)
        (define MoveY 0.5)
        (define MoveZ 0.5)
        
        (we:we:transform_vs!
            (list 1.0 0.0 0.0
                  0.0 1.0 0.0
                  0.0 0.0 1.0
                  MoveX MoveY MoveZ))

        (list)
        ))
</pre></code>

A list of all the available callable we functions is available in the w3d_we function references.

An .wscr file to use for the we function command script:

<code><pre>
type "scm"
name ?__(1,"Example We Script")
desc "Example We Script"
mode "body"
params_title ?__(2,"Example We Script")
params_preview 1
params {
  param "Unused" 0.0
}
</pre></code>




